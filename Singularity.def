Bootstrap: docker
From: continuumio/miniconda3

%post
    apt-get -y update
    apt-get -y upgrade
    apt-get install -y libgl1-mesa-glx
    # Create a conda environment using the provided file
    . /opt/conda/etc/profile.d/conda.sh   # Source the conda script
    conda env create -f /tmp/environment.yml
    conda activate hpc
    conda install -c conda-forge opencv
    # Create directories
    mkdir -m 777 -p /tmp
    mkdir -m 777 -p /local_scratch


%environment
    export PATH=/opt/conda/envs/hpc/bin:$PATH

%runscript
    . /opt/conda/etc/profile.d/conda.sh
    conda activate hpc
    cd /local_scratch
