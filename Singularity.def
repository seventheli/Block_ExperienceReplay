Bootstrap: docker
From: nvidia/cuda:11.6.2-cudnn8-runtime-ubuntu20.04

%post
    apt-get -y update
    apt-get -y install g++ build-essential wget bzip2
    export PATH="/opt/conda/bin:$PATH"
    apt-get -y install python3 python3-pip
    pip3 install torch==1.12.1+cu113 torchvision==0.13.1+cu113  -f https://download.pytorch.org/whl/torch_stable.html
    pip3 install torchaudio==0.12.1 numpy==1.21.4 \
    grpcio==1.48.2 ale-py==0.7.5 ray==2.2.0 ray[default]==2.2.0 ray[rllib]==2.2.0 \
    ray[tune]==2.2.0 ray[air]==2.2.0 gym==0.23.1 mlflow pyyaml func_timeout \
    tqdm dynaconf gym[accept-rom-license] gputil

%environment
    export PATH=/usr/local/nvidia/bin:/usr/local/cuda/bin:${PATH}
    export LD_LIBRARY_PATH=/usr/local/nvidia/lib:/usr/local/nvidia/lib64
    export NCCL_SOCKET_IFNAME='lo,docker,vethc'
    . /opt/conda/etc/profile.d/conda.sh
    conda activate hpc

%files
    /home/seventheli/research/Block_ExperienceReplay /local_scratch

%runscript
    cd /local_scratch

